# ============================================================================
# TIKTOKEN OFFLINE CACHE SETUP
# Add this to your Dockerfile after the dependencies stage and before application stage
# ============================================================================

# Copy the download script
COPY scripts/download_tiktoken_cache.sh /tmp/download_tiktoken_cache.sh
RUN chmod +x /tmp/download_tiktoken_cache.sh

# Pre-download tiktoken encodings for offline operation
RUN /tmp/download_tiktoken_cache.sh && rm /tmp/download_tiktoken_cache.sh

# Set environment variables for offline operation
ENV TIKTOKEN_CACHE_DIR=/app/.cache/tiktoken \
    TIKTOKEN_CACHE_ONLY=1 \
    TIKTOKEN_DISABLE_DOWNLOAD=1

# Ensure the cache directory is owned by the application user
RUN chown -R pipeline:pipeline /app/.cache/ 2>/dev/null || true

# ============================================================================
# END TIKTOKEN OFFLINE SETUP
# ============================================================================
